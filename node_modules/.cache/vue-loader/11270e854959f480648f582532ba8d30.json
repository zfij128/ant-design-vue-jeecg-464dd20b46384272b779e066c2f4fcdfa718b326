{"remainingRequest":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\components\\jeecgbiz\\modal\\JSelectDepartModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\components\\jeecgbiz\\modal\\JSelectDepartModal.vue","mtime":1665386876000},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js","mtime":1665642924601},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js","mtime":1665642924058}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { queryDepartTreeList } from '@/api/api'\nexport default {\n  name: 'JSelectDepartModal',\n  props:['modalWidth','multi','rootOpened','departId', 'store', 'text','treeOpera'],\n  data(){\n    return {\n      visible:false,\n      confirmLoading:false,\n      treeData:[],\n      autoExpandParent:true,\n      expandedKeys:[],\n      dataList:[],\n      checkedKeys:[],\n      checkedRows:[],\n      searchValue:\"\",\n      checkStrictly: true,\n      fullscreen:false\n    }\n  },\n  created(){\n    this.loadDepart();\n  },\n  watch:{\n    departId(){\n      this.initDepartComponent()\n    },\n    visible: {\n      handler() {\n        this.initDepartComponent(true)\n      }\n    }\n  },\n  computed:{\n    treeScreenClass() {\n      return {\n        'my-dept-select-tree': true,\n        'fullscreen': this.fullscreen,\n      }\n    },\n    filterTreeData(){\n      if(!this.searchValue){\n        return this.treeData\n      }\n      let filter = []\n      this.dataList.forEach((item) => {\n        if (item.title.includes(this.searchValue)) {\n          filter.push(Object.assign({}, item, {children: null, isLeaf: true}))\n        }\n      })\n      return filter\n    },\n  },\n  methods:{\n    show(){\n      this.visible=true\n      this.checkedRows=[]\n      this.checkedKeys=[]\n    },\n    loadDepart(){\n      // 这个方法是找到所有的部门信息\n      queryDepartTreeList().then(res=>{\n        if(res.success){\n          let arr = [...res.result]\n          this.reWriterWithSlot(arr)\n          this.treeData = arr\n          this.initDepartComponent()\n          if(this.rootOpened){\n            this.initExpandedKeys(res.result)\n          }\n        }\n      })\n    },\n    initDepartComponent(flag){\n      let arr = []\n      //该方法两个地方用 1.visible改变事件重新设置选中项 2.组件编辑页面回显\n      let fieldName = flag==true?'key':this.text\n      if(this.departId){\n        let arr2 = this.departId.split(',')\n        for(let item of this.dataList){\n          if(arr2.indexOf(item[this.store])>=0){\n            arr.push(item[fieldName])\n          }\n        }\n      }\n      if(flag==true){\n        this.checkedKeys = [...arr]\n      }else{\n        this.$emit(\"initComp\", arr.join(','))\n      }\n    },\n    reWriterWithSlot(arr){\n      for(let item of arr){\n        if(item.children && item.children.length>0){\n          this.reWriterWithSlot(item.children)\n          let temp = Object.assign({},item)\n          temp.children = {}\n          this.dataList.push(temp)\n        }else{\n          this.dataList.push(item)\n          item.scopedSlots={ title: 'title' }\n        }\n      }\n    },\n    initExpandedKeys(arr){\n      if(arr && arr.length>0){\n        let keys = []\n        for(let item of arr){\n          if(item.children && item.children.length>0){\n            keys.push(item.id)\n          }\n        }\n        this.expandedKeys=[...keys]\n        //全部keys\n        //this.allTreeKeys = [...keys]\n      }else{\n        this.expandedKeys=[]\n        //this.allTreeKeys = []\n      }\n    },\n    onCheck (checkedKeys,info) {\n      if(!this.multi){\n        let arr = checkedKeys.checked.filter(item => this.checkedKeys.indexOf(item) < 0)\n        this.checkedKeys = [...arr]\n        this.checkedRows = (this.checkedKeys.length === 0) ? [] : [info.node.dataRef]\n      }else{\n        if(this.checkStrictly){\n          this.checkedKeys = checkedKeys.checked\n        }else{\n          this.checkedKeys = checkedKeys\n        }\n        this.checkedRows = this.getCheckedRows(this.checkedKeys)\n      }\n    },\n    onSelect(selectedKeys,info) {\n      //取消关联的情况下才走onSelect的逻辑\n      if(this.checkStrictly){\n        let keys = []\n        keys.push(selectedKeys[0])\n        if(!this.checkedKeys || this.checkedKeys.length===0 || !this.multi){\n          this.checkedKeys = [...keys]\n          this.checkedRows=[info.node.dataRef]\n        }else{\n          let currKey = info.node.dataRef.key\n          if(this.checkedKeys.indexOf(currKey)>=0){\n            this.checkedKeys = this.checkedKeys.filter(item=> item !==currKey)\n          }else{\n            this.checkedKeys.push(...keys)\n          }\n        }\n        this.checkedRows = this.getCheckedRows(this.checkedKeys)\n      }\n    },\n    onExpand (expandedKeys) {\n      this.expandedKeys = expandedKeys\n      this.autoExpandParent = false\n    },\n    handleSubmit(){\n      if(!this.checkedKeys || this.checkedKeys.length==0){\n        this.$emit(\"ok\",'')\n      }else{\n        let checkRow = this.getCheckedRows(this.checkedKeys)\n        let keyStr = this.checkedKeys.join(\",\")\n        this.$emit(\"ok\", checkRow, keyStr)\n      }\n      this.handleClear()\n    },\n    handleCancel(){\n      this.handleClear()\n    },\n    handleClear(){\n      this.visible=false\n      this.checkedKeys=[]\n    },\n    getParentKey(currKey,treeData){\n      let parentKey\n      for (let i = 0; i < treeData.length; i++) {\n        const node = treeData[i]\n        if (node.children) {\n          if (node.children.some(item => item.key === currKey)) {\n            parentKey = node.key\n          } else if (this.getParentKey(currKey, node.children)) {\n            parentKey = this.getParentKey(currKey, node.children)\n          }\n        }\n      }\n      return parentKey\n    },\n    // 根据 checkedKeys 获取 rows\n    getCheckedRows(checkedKeys) {\n      const forChildren = (list, key) => {\n        for (let item of list) {\n          if (item.id === key) {\n            return item\n          }\n          if (item.children instanceof Array) {\n            let value = forChildren(item.children, key)\n            if (value != null) {\n              return value\n            }\n          }\n        }\n        return null\n      }\n\n      let rows = []\n      for (let key of checkedKeys) {\n        let row = forChildren(this.treeData, key)\n        if (row != null) {\n          rows.push(row)\n        }\n      }\n      return rows\n    },\n    switchCheckStrictly (v) {\n      if(v==1){\n        this.checkStrictly = false\n      }else if(v==2){\n        this.checkStrictly = true\n      }\n    },\n    isFullscreen(val){\n      this.fullscreen=val\n    }\n  }\n}\n\n",{"version":3,"sources":["JSelectDepartModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"JSelectDepartModal.vue","sourceRoot":"src/components/jeecgbiz/modal","sourcesContent":["<template>\n  <j-modal\n    title=\"选择部门\"\n    :width=\"modalWidth\"\n    :visible=\"visible\"\n    :confirmLoading=\"confirmLoading\"\n    @ok=\"handleSubmit\"\n    @cancel=\"handleCancel\"\n    @update:fullscreen=\"isFullscreen\"\n    wrapClassName=\"j-depart-select-modal\"\n    switchFullscreen\n    cancelText=\"关闭\">\n    <a-spin tip=\"Loading...\" :spinning=\"false\">\n      <a-input-search v-model=\"searchValue\" style=\"margin-bottom: 1px\" placeholder=\"请输入部门名称按回车进行搜索\" />\n      <a-empty v-if=\"filterTreeData.length===0\"></a-empty>\n      <a-tree\n        v-else\n        checkable\n        :class=\"treeScreenClass\"\n        :treeData=\"filterTreeData\"\n        :checkStrictly=\"checkStrictly\"\n        @check=\"onCheck\"\n        @select=\"onSelect\"\n        @expand=\"onExpand\"\n        :autoExpandParent=\"autoExpandParent\"\n        :expandedKeys=\"expandedKeys\"\n        :checkedKeys=\"checkedKeys\">\n\n      </a-tree>\n    </a-spin>\n    <!--底部父子关联操作和确认取消按钮-->\n    <template slot=\"footer\" v-if=\"treeOpera && multi\">\n      <div class=\"drawer-bootom-button\">\n        <a-dropdown style=\"float: left\" :trigger=\"['click']\" placement=\"topCenter\">\n          <a-menu slot=\"overlay\">\n            <a-menu-item key=\"1\" @click=\"switchCheckStrictly(1)\">父子关联</a-menu-item>\n            <a-menu-item key=\"2\" @click=\"switchCheckStrictly(2)\">取消关联</a-menu-item>\n          </a-menu>\n          <a-button>\n            树操作 <a-icon type=\"up\" />\n          </a-button>\n        </a-dropdown>\n        <a-button @click=\"handleCancel\" type=\"primary\" style=\"margin-right: 0.8rem\">关闭</a-button>\n        <a-button @click=\"handleSubmit\" type=\"primary\" >确认</a-button>\n      </div>\n    </template>\n  </j-modal>\n</template>\n\n<script>\n  import { queryDepartTreeList } from '@/api/api'\n  export default {\n    name: 'JSelectDepartModal',\n    props:['modalWidth','multi','rootOpened','departId', 'store', 'text','treeOpera'],\n    data(){\n      return {\n        visible:false,\n        confirmLoading:false,\n        treeData:[],\n        autoExpandParent:true,\n        expandedKeys:[],\n        dataList:[],\n        checkedKeys:[],\n        checkedRows:[],\n        searchValue:\"\",\n        checkStrictly: true,\n        fullscreen:false\n      }\n    },\n    created(){\n      this.loadDepart();\n    },\n    watch:{\n      departId(){\n        this.initDepartComponent()\n      },\n      visible: {\n        handler() {\n          this.initDepartComponent(true)\n        }\n      }\n    },\n    computed:{\n      treeScreenClass() {\n        return {\n          'my-dept-select-tree': true,\n          'fullscreen': this.fullscreen,\n        }\n      },\n      filterTreeData(){\n        if(!this.searchValue){\n          return this.treeData\n        }\n        let filter = []\n        this.dataList.forEach((item) => {\n          if (item.title.includes(this.searchValue)) {\n            filter.push(Object.assign({}, item, {children: null, isLeaf: true}))\n          }\n        })\n        return filter\n      },\n    },\n    methods:{\n      show(){\n        this.visible=true\n        this.checkedRows=[]\n        this.checkedKeys=[]\n      },\n      loadDepart(){\n        // 这个方法是找到所有的部门信息\n        queryDepartTreeList().then(res=>{\n          if(res.success){\n            let arr = [...res.result]\n            this.reWriterWithSlot(arr)\n            this.treeData = arr\n            this.initDepartComponent()\n            if(this.rootOpened){\n              this.initExpandedKeys(res.result)\n            }\n          }\n        })\n      },\n      initDepartComponent(flag){\n        let arr = []\n        //该方法两个地方用 1.visible改变事件重新设置选中项 2.组件编辑页面回显\n        let fieldName = flag==true?'key':this.text\n        if(this.departId){\n          let arr2 = this.departId.split(',')\n          for(let item of this.dataList){\n            if(arr2.indexOf(item[this.store])>=0){\n              arr.push(item[fieldName])\n            }\n          }\n        }\n        if(flag==true){\n          this.checkedKeys = [...arr]\n        }else{\n          this.$emit(\"initComp\", arr.join(','))\n        }\n      },\n      reWriterWithSlot(arr){\n        for(let item of arr){\n          if(item.children && item.children.length>0){\n            this.reWriterWithSlot(item.children)\n            let temp = Object.assign({},item)\n            temp.children = {}\n            this.dataList.push(temp)\n          }else{\n            this.dataList.push(item)\n            item.scopedSlots={ title: 'title' }\n          }\n        }\n      },\n      initExpandedKeys(arr){\n        if(arr && arr.length>0){\n          let keys = []\n          for(let item of arr){\n            if(item.children && item.children.length>0){\n              keys.push(item.id)\n            }\n          }\n          this.expandedKeys=[...keys]\n          //全部keys\n          //this.allTreeKeys = [...keys]\n        }else{\n          this.expandedKeys=[]\n          //this.allTreeKeys = []\n        }\n      },\n      onCheck (checkedKeys,info) {\n        if(!this.multi){\n          let arr = checkedKeys.checked.filter(item => this.checkedKeys.indexOf(item) < 0)\n          this.checkedKeys = [...arr]\n          this.checkedRows = (this.checkedKeys.length === 0) ? [] : [info.node.dataRef]\n        }else{\n          if(this.checkStrictly){\n            this.checkedKeys = checkedKeys.checked\n          }else{\n            this.checkedKeys = checkedKeys\n          }\n          this.checkedRows = this.getCheckedRows(this.checkedKeys)\n        }\n      },\n      onSelect(selectedKeys,info) {\n        //取消关联的情况下才走onSelect的逻辑\n        if(this.checkStrictly){\n          let keys = []\n          keys.push(selectedKeys[0])\n          if(!this.checkedKeys || this.checkedKeys.length===0 || !this.multi){\n            this.checkedKeys = [...keys]\n            this.checkedRows=[info.node.dataRef]\n          }else{\n            let currKey = info.node.dataRef.key\n            if(this.checkedKeys.indexOf(currKey)>=0){\n              this.checkedKeys = this.checkedKeys.filter(item=> item !==currKey)\n            }else{\n              this.checkedKeys.push(...keys)\n            }\n          }\n          this.checkedRows = this.getCheckedRows(this.checkedKeys)\n        }\n      },\n      onExpand (expandedKeys) {\n        this.expandedKeys = expandedKeys\n        this.autoExpandParent = false\n      },\n      handleSubmit(){\n        if(!this.checkedKeys || this.checkedKeys.length==0){\n          this.$emit(\"ok\",'')\n        }else{\n          let checkRow = this.getCheckedRows(this.checkedKeys)\n          let keyStr = this.checkedKeys.join(\",\")\n          this.$emit(\"ok\", checkRow, keyStr)\n        }\n        this.handleClear()\n      },\n      handleCancel(){\n        this.handleClear()\n      },\n      handleClear(){\n        this.visible=false\n        this.checkedKeys=[]\n      },\n      getParentKey(currKey,treeData){\n        let parentKey\n        for (let i = 0; i < treeData.length; i++) {\n          const node = treeData[i]\n          if (node.children) {\n            if (node.children.some(item => item.key === currKey)) {\n              parentKey = node.key\n            } else if (this.getParentKey(currKey, node.children)) {\n              parentKey = this.getParentKey(currKey, node.children)\n            }\n          }\n        }\n        return parentKey\n      },\n      // 根据 checkedKeys 获取 rows\n      getCheckedRows(checkedKeys) {\n        const forChildren = (list, key) => {\n          for (let item of list) {\n            if (item.id === key) {\n              return item\n            }\n            if (item.children instanceof Array) {\n              let value = forChildren(item.children, key)\n              if (value != null) {\n                return value\n              }\n            }\n          }\n          return null\n        }\n\n        let rows = []\n        for (let key of checkedKeys) {\n          let row = forChildren(this.treeData, key)\n          if (row != null) {\n            rows.push(row)\n          }\n        }\n        return rows\n      },\n      switchCheckStrictly (v) {\n        if(v==1){\n          this.checkStrictly = false\n        }else if(v==2){\n          this.checkStrictly = true\n        }\n      },\n      isFullscreen(val){\n        this.fullscreen=val\n      }\n    }\n  }\n\n</script>\n\n<style lang=\"less\" scoped>\n  // 限制部门选择树高度，避免部门太多时点击确定不便\n  .my-dept-select-tree{\n    height:350px;\n    \n    &.fullscreen{\n      height: calc(100vh - 250px);\n    }\n    overflow-y: scroll;\n  }\n  .drawer-bootom-button {\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    border-top: 1px solid #e8e8e8;\n    padding: 10px 16px;\n    text-align: right;\n    left: 0;\n    background: #fff;\n    border-radius: 0 0 2px 2px;\n  }\n</style>"]}]}