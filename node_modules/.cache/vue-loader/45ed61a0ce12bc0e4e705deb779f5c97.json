{"remainingRequest":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\components\\jeecg\\JImportModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\components\\jeecg\\JImportModal.vue","mtime":1665386876000},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js","mtime":1665642924601},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js","mtime":1665642924058}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { postAction } from '@/api/manage'\nexport default {\n  name: 'JImportModal',\n  props:{\n    url:{\n      type: String,\n      default: '',\n      required: false\n    },\n    biz:{\n      type: String,\n      default: '',\n      required: false\n    },\n    //是否online导入\n    online:{\n      type: Boolean,\n      default: false,\n      required: false\n    }\n  },\n  data(){\n    return {\n      visible:false,\n      uploading:false,\n      fileList:[],\n      uploadAction:'',\n      foreignKeys:'',\n      validateStatus: 0\n    }\n  },\n  watch: {\n    url (val) {\n      if(val){\n       this.uploadAction = window._CONFIG['domianURL']+val\n      }\n    }\n  },\n  created () {\n    this.uploadAction = window._CONFIG['domianURL']+this.url\n  },\n\n  methods:{\n    handleClose(){\n      this.visible=false\n    },\n    show(arg){\n      this.fileList = []\n      this.uploading = false\n      this.visible = true\n      this.foreignKeys = arg;\n      this.validateStatus = 0\n    },\n    handleRemove(file) {\n      const index = this.fileList.indexOf(file);\n      const newFileList = this.fileList.slice();\n      newFileList.splice(index, 1);\n      this.fileList = newFileList\n    },\n    beforeUpload(file) {\n      this.fileList = [...this.fileList, file]\n      return false;\n    },\n    handleImport() {\n      const { fileList } = this;\n      const formData = new FormData();\n      if(this.biz){\n        formData.append('isSingleTableImport',this.biz);\n      }\n      if(this.foreignKeys && this.foreignKeys.length>0){\n        formData.append('foreignKeys',this.foreignKeys);\n      }\n      if(this.online==true){\n        formData.append('validateStatus',this.validateStatus);\n      }\n      fileList.forEach((file) => {\n        formData.append('files[]', file);\n      });\n      this.uploading = true\n      postAction(this.uploadAction, formData).then((res) => {\n        this.uploading = false\n        if(res.success){\n          if(res.code == 201){\n            this.errorTip(res.message, res.result)\n          }else{\n            this.$message.success(res.message)\n          }\n          this.visible=false\n          this.$emit('ok')\n        }else{\n          this.$message.warning(res.message)\n        }\n      })\n    },\n    // 是否开启校验 开关改变事件\n    handleChangeValidateStatus(checked){\n      this.validateStatus = checked==true?1:0\n    },\n    // 错误信息提示\n    errorTip(tipMessage, fileUrl) {\n      const h = this.$createElement;\n      let href = window._CONFIG['domianURL'] + fileUrl\n      this.$warning({\n        title: '导入成功,但是有错误数据!',\n        content: h('div', {}, [\n          h('div', tipMessage),\n          h('span', '具体详情请 '),\n          h('a', {\n            attrs: {\n              href: href,\n              target: '_blank'\n            },\n          },'点击下载'),\n        ]),\n        onOk() {},\n      });\n    },\n\n  }\n}\n",{"version":3,"sources":["JImportModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"JImportModal.vue","sourceRoot":"src/components/jeecg","sourcesContent":["<template>\n  <a-modal\n    title=\"导入EXCEL\"\n    :width=\"600\"\n    :visible=\"visible\"\n    :confirmLoading=\"uploading\"\n    @cancel=\"handleClose\">\n\n    <div style=\"margin: 0px 0px 5px 1px\" v-if=\"online\">\n      <span style=\"display: inline-block;height: 32px;line-height: 32px;vertical-align: middle;\">是否开启校验:</span>\n      <span style=\"display: inline-block;height: 32px;margin-left: 6px\">\n         <a-switch :checked=\"validateStatus==1\" @change=\"handleChangeValidateStatus\" checked-children=\"是\" un-checked-children=\"否\" size=\"small\"/>\n      </span>\n    </div>\n\n    <a-upload\n      name=\"file\"\n      :multiple=\"true\"\n      accept=\".xls,.xlsx\"\n      :fileList=\"fileList\"\n      :remove=\"handleRemove\"\n      :beforeUpload=\"beforeUpload\">\n      <a-button>\n        <a-icon type=\"upload\" />\n        选择导入文件\n      </a-button>\n    </a-upload>\n\n    <template slot=\"footer\">\n      <a-button @click=\"handleClose\">关闭</a-button>\n      <a-button\n        type=\"primary\"\n        @click=\"handleImport\"\n        :disabled=\"fileList.length === 0\"\n        :loading=\"uploading\">\n        {{ uploading ? '上传中...' : '开始上传' }}\n      </a-button>\n    </template>\n\n  </a-modal>\n</template>\n\n<script>\n  import { postAction } from '@/api/manage'\n  export default {\n    name: 'JImportModal',\n    props:{\n      url:{\n        type: String,\n        default: '',\n        required: false\n      },\n      biz:{\n        type: String,\n        default: '',\n        required: false\n      },\n      //是否online导入\n      online:{\n        type: Boolean,\n        default: false,\n        required: false\n      }\n    },\n    data(){\n      return {\n        visible:false,\n        uploading:false,\n        fileList:[],\n        uploadAction:'',\n        foreignKeys:'',\n        validateStatus: 0\n      }\n    },\n    watch: {\n      url (val) {\n        if(val){\n         this.uploadAction = window._CONFIG['domianURL']+val\n        }\n      }\n    },\n    created () {\n      this.uploadAction = window._CONFIG['domianURL']+this.url\n    },\n\n    methods:{\n      handleClose(){\n        this.visible=false\n      },\n      show(arg){\n        this.fileList = []\n        this.uploading = false\n        this.visible = true\n        this.foreignKeys = arg;\n        this.validateStatus = 0\n      },\n      handleRemove(file) {\n        const index = this.fileList.indexOf(file);\n        const newFileList = this.fileList.slice();\n        newFileList.splice(index, 1);\n        this.fileList = newFileList\n      },\n      beforeUpload(file) {\n        this.fileList = [...this.fileList, file]\n        return false;\n      },\n      handleImport() {\n        const { fileList } = this;\n        const formData = new FormData();\n        if(this.biz){\n          formData.append('isSingleTableImport',this.biz);\n        }\n        if(this.foreignKeys && this.foreignKeys.length>0){\n          formData.append('foreignKeys',this.foreignKeys);\n        }\n        if(this.online==true){\n          formData.append('validateStatus',this.validateStatus);\n        }\n        fileList.forEach((file) => {\n          formData.append('files[]', file);\n        });\n        this.uploading = true\n        postAction(this.uploadAction, formData).then((res) => {\n          this.uploading = false\n          if(res.success){\n            if(res.code == 201){\n              this.errorTip(res.message, res.result)\n            }else{\n              this.$message.success(res.message)\n            }\n            this.visible=false\n            this.$emit('ok')\n          }else{\n            this.$message.warning(res.message)\n          }\n        })\n      },\n      // 是否开启校验 开关改变事件\n      handleChangeValidateStatus(checked){\n        this.validateStatus = checked==true?1:0\n      },\n      // 错误信息提示\n      errorTip(tipMessage, fileUrl) {\n        const h = this.$createElement;\n        let href = window._CONFIG['domianURL'] + fileUrl\n        this.$warning({\n          title: '导入成功,但是有错误数据!',\n          content: h('div', {}, [\n            h('div', tipMessage),\n            h('span', '具体详情请 '),\n            h('a', {\n              attrs: {\n                href: href,\n                target: '_blank'\n              },\n            },'点击下载'),\n          ]),\n          onOk() {},\n        });\n      },\n\n    }\n  }\n</script>\n\n<style scoped>\n\n</style>"]}]}