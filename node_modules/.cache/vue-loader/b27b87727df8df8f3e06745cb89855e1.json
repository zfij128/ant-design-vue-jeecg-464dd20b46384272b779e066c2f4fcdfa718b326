{"remainingRequest":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\views\\user\\oauth2\\OAuth2Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\views\\user\\oauth2\\OAuth2Login.vue","mtime":1665386876000},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js","mtime":1665642924601},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js","mtime":1665642924058}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapActions } from 'vuex'\nimport { isOAuth2AppEnv, timeFix } from '@/utils/util'\nimport { INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types'\n\nexport default {\n  name: 'OAuth2Login',\n  data() {\n    return {\n      env: {\n        thirdApp: false,\n        wxWork: false,\n        dingtalk: false,\n      },\n    }\n  },\n  beforeCreate() {\n    // 如果当前 不是 OAuth2APP环境，就重定向到 /user/login 页面\n    if (!isOAuth2AppEnv()) {\n      this.$router.replace({path: '/user/login'})\n    }\n  },\n  created() {\n    this.checkEnv()\n    this.doOAuth2Login()\n  },\n  methods: {\n    ...mapActions(['ThirdLogin']),\n\n    /** 检测当前的环境 */\n    checkEnv() {\n      // 判断当时是否是企业微信环境\n      if (/wxwork/i.test(navigator.userAgent)) {\n        this.env.thirdApp = true\n        this.env.wxWork = true\n      }\n      // 判断当时是否是钉钉环境\n      if (/dingtalk/i.test(navigator.userAgent)) {\n        this.env.thirdApp = true\n        this.env.dingtalk = true\n      }\n    },\n\n    /** 进行OAuth2登录操作 */\n    doOAuth2Login() {\n      if (this.env.thirdApp) {\n        // 判断是否携带了Token，是就说明登录成功\n        if (this.$route.query.oauth2LoginToken) {\n          this.thirdType = this.$route.query.thirdType\n          let token = this.$route.query.oauth2LoginToken\n          this.doThirdLogin(token)\n        } else if (this.env.wxWork) {\n          this.doWechatEnterpriseOAuth2Login()\n        } else if (this.env.dingtalk) {\n          this.doDingTalkOAuth2Login()\n        }\n      }\n    },\n\n    // 根据token执行登录\n    doThirdLogin(token) {\n      let param = {}\n      param.thirdType = this.thirdType\n      param.token = token\n      this.ThirdLogin(param).then(res => {\n        if (res.success) {\n          this.loginSuccess()\n        } else {\n          this.requestFailed(res)\n        }\n      })\n    },\n    loginSuccess() {\n      // 登陆成功，重定向到主页\n      this.$router.replace({path: INDEX_MAIN_PAGE_PATH})\n      // TODO 这个提示是否还需要？\n      this.$notification.success({\n        message: '欢迎',\n        description: `${timeFix()}，欢迎回来`,\n      })\n    },\n    requestFailed(err) {\n      this.$error({\n        title: '登录失败',\n        content: ((err.response || {}).data || {}).message || err.message || '请求出现错误，请稍后再试',\n        okText: '重新登陆',\n        onOk() {\n          window.location.reload()\n        },\n        onCancel() {\n          window.location.reload()\n        },\n      })\n    },\n\n    /** 企业微信OAuth2登录 */\n    doWechatEnterpriseOAuth2Login() {\n      this.sysOAuth2Login('wechat_enterprise')\n    },\n\n    /** 钉钉OAuth2登录 */\n    doDingTalkOAuth2Login() {\n      this.sysOAuth2Login('dingtalk')\n    },\n\n    /** 后台构造oauth2登录地址 */\n    sysOAuth2Login(source) {\n      let url = `${window._CONFIG['domianURL']}/sys/thirdLogin/oauth2/${source}/login`\n      url += `?state=${encodeURIComponent(window.location.origin)}`\n      window.location.href = url\n    },\n\n  },\n}\n",{"version":3,"sources":["OAuth2Login.vue"],"names":[],"mappings":";;;;;;;;;;;;AAYA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"OAuth2Login.vue","sourceRoot":"src/views/user/oauth2","sourcesContent":["<template>\n  <div>\n    <div id=\"loader-wrapper\">\n      <div id=\"loader\"></div>\n      <div class=\"loader-section section-left\"></div>\n      <div class=\"loader-section section-right\"></div>\n      <div class=\"load_title\">正在登录 云晟科技，请耐心等待</div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapActions } from 'vuex'\nimport { isOAuth2AppEnv, timeFix } from '@/utils/util'\nimport { INDEX_MAIN_PAGE_PATH } from '@/store/mutation-types'\n\nexport default {\n  name: 'OAuth2Login',\n  data() {\n    return {\n      env: {\n        thirdApp: false,\n        wxWork: false,\n        dingtalk: false,\n      },\n    }\n  },\n  beforeCreate() {\n    // 如果当前 不是 OAuth2APP环境，就重定向到 /user/login 页面\n    if (!isOAuth2AppEnv()) {\n      this.$router.replace({path: '/user/login'})\n    }\n  },\n  created() {\n    this.checkEnv()\n    this.doOAuth2Login()\n  },\n  methods: {\n    ...mapActions(['ThirdLogin']),\n\n    /** 检测当前的环境 */\n    checkEnv() {\n      // 判断当时是否是企业微信环境\n      if (/wxwork/i.test(navigator.userAgent)) {\n        this.env.thirdApp = true\n        this.env.wxWork = true\n      }\n      // 判断当时是否是钉钉环境\n      if (/dingtalk/i.test(navigator.userAgent)) {\n        this.env.thirdApp = true\n        this.env.dingtalk = true\n      }\n    },\n\n    /** 进行OAuth2登录操作 */\n    doOAuth2Login() {\n      if (this.env.thirdApp) {\n        // 判断是否携带了Token，是就说明登录成功\n        if (this.$route.query.oauth2LoginToken) {\n          this.thirdType = this.$route.query.thirdType\n          let token = this.$route.query.oauth2LoginToken\n          this.doThirdLogin(token)\n        } else if (this.env.wxWork) {\n          this.doWechatEnterpriseOAuth2Login()\n        } else if (this.env.dingtalk) {\n          this.doDingTalkOAuth2Login()\n        }\n      }\n    },\n\n    // 根据token执行登录\n    doThirdLogin(token) {\n      let param = {}\n      param.thirdType = this.thirdType\n      param.token = token\n      this.ThirdLogin(param).then(res => {\n        if (res.success) {\n          this.loginSuccess()\n        } else {\n          this.requestFailed(res)\n        }\n      })\n    },\n    loginSuccess() {\n      // 登陆成功，重定向到主页\n      this.$router.replace({path: INDEX_MAIN_PAGE_PATH})\n      // TODO 这个提示是否还需要？\n      this.$notification.success({\n        message: '欢迎',\n        description: `${timeFix()}，欢迎回来`,\n      })\n    },\n    requestFailed(err) {\n      this.$error({\n        title: '登录失败',\n        content: ((err.response || {}).data || {}).message || err.message || '请求出现错误，请稍后再试',\n        okText: '重新登陆',\n        onOk() {\n          window.location.reload()\n        },\n        onCancel() {\n          window.location.reload()\n        },\n      })\n    },\n\n    /** 企业微信OAuth2登录 */\n    doWechatEnterpriseOAuth2Login() {\n      this.sysOAuth2Login('wechat_enterprise')\n    },\n\n    /** 钉钉OAuth2登录 */\n    doDingTalkOAuth2Login() {\n      this.sysOAuth2Login('dingtalk')\n    },\n\n    /** 后台构造oauth2登录地址 */\n    sysOAuth2Login(source) {\n      let url = `${window._CONFIG['domianURL']}/sys/thirdLogin/oauth2/${source}/login`\n      url += `?state=${encodeURIComponent(window.location.origin)}`\n      window.location.href = url\n    },\n\n  },\n}\n</script>\n\n<style scoped>\n\n</style>"]}]}