{"remainingRequest":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\utils\\authFilter.js","dependencies":[{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\utils\\authFilter.js","mtime":1665386876000},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js","mtime":1665642924601},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1665642923347}],"contextDependencies":[],"result":["function _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport { USER_AUTH, SYS_BUTTON_AUTH } from \"@/store/mutation-types\";\nexport function disabledAuthFilter(code, formData) {\n  if (nodeDisabledAuth(code, formData)) {\n    return true;\n  } else {\n    return globalDisabledAuth(code);\n  }\n}\n\nfunction nodeDisabledAuth(code, formData) {\n  //console.log(\"页面权限禁用--NODE--开始\");\n  var permissionList = [];\n\n  try {\n    //console.log(\"页面权限禁用--NODE--开始\",formData);\n    if (formData) {\n      var bpmList = formData.permissionList;\n      permissionList = bpmList.filter(function (item) {\n        return item.type == '2';\n      }); // for (let bpm of bpmList) {\n      //   if(bpm.type == '2') {\n      //     permissionList.push(bpm);\n      //   }\n      // }\n    } else {\n      return false;\n    }\n  } catch (e) {//console.log(\"页面权限异常----\", e);\n  }\n\n  if (permissionList.length == 0) {\n    return false;\n  }\n\n  console.log(\"流程节点页面权限禁用--NODE--开始\");\n  var permissions = [];\n\n  var _iterator = _createForOfIteratorHelper(permissionList),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var item = _step.value;\n\n      if (item.type == '2') {\n        permissions.push(item.action);\n      }\n    } //console.log(\"页面权限----\"+code);\n\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  if (!permissions.includes(code)) {\n    return false;\n  } else {\n    var _iterator2 = _createForOfIteratorHelper(permissionList),\n        _step2;\n\n    try {\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        var item2 = _step2.value;\n\n        if (code === item2.action) {\n          console.log(\"流程节点页面权限禁用--NODE--生效\");\n          return true;\n        }\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n  }\n\n  return false;\n}\n\nfunction globalDisabledAuth(code) {\n  //console.log(\"全局页面禁用权限--Global--开始\");\n  var permissionList = [];\n  var allPermissionList = []; //let authList = Vue.ls.get(USER_AUTH);\n\n  var authList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n\n  var _iterator3 = _createForOfIteratorHelper(authList),\n      _step3;\n\n  try {\n    for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n      var auth = _step3.value;\n\n      if (auth.type == '2') {\n        permissionList.push(auth);\n      }\n    } //console.log(\"页面禁用权限--Global--\",sessionStorage.getItem(SYS_BUTTON_AUTH));\n\n  } catch (err) {\n    _iterator3.e(err);\n  } finally {\n    _iterator3.f();\n  }\n\n  var allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n\n  var _iterator4 = _createForOfIteratorHelper(allAuthList),\n      _step4;\n\n  try {\n    for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n      var gauth = _step4.value;\n\n      if (gauth.type == '2') {\n        allPermissionList.push(gauth);\n      }\n    } //设置全局配置是否有命中\n\n  } catch (err) {\n    _iterator4.e(err);\n  } finally {\n    _iterator4.f();\n  }\n\n  var gFlag = false; //禁用命中\n\n  var invalidFlag = false; //无效命中\n\n  if (allPermissionList != null && allPermissionList != \"\" && allPermissionList != undefined && allPermissionList.length > 0) {\n    var _iterator5 = _createForOfIteratorHelper(allPermissionList),\n        _step5;\n\n    try {\n      for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n        var itemG = _step5.value;\n\n        if (code === itemG.action) {\n          if (itemG.status == '0') {\n            invalidFlag = true;\n            break;\n          } else {\n            gFlag = true;\n            break;\n          }\n        }\n      }\n    } catch (err) {\n      _iterator5.e(err);\n    } finally {\n      _iterator5.f();\n    }\n  }\n\n  if (invalidFlag) {\n    return false;\n  }\n\n  if (permissionList === null || permissionList === \"\" || permissionList === undefined || permissionList.length <= 0) {\n    return gFlag;\n  }\n\n  var permissions = [];\n\n  for (var _i = 0, _permissionList = permissionList; _i < _permissionList.length; _i++) {\n    var item = _permissionList[_i];\n\n    if (item.type == '2') {\n      permissions.push(item.action);\n    }\n  } //console.log(\"页面禁用权限----\"+code);\n\n\n  if (!permissions.includes(code)) {\n    return gFlag;\n  } else {\n    var _iterator6 = _createForOfIteratorHelper(permissionList),\n        _step6;\n\n    try {\n      for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n        var item2 = _step6.value;\n\n        if (code === item2.action) {\n          //console.log(\"全局页面权限解除禁用--Global--生效\");\n          gFlag = false;\n        }\n      }\n    } catch (err) {\n      _iterator6.e(err);\n    } finally {\n      _iterator6.f();\n    }\n\n    return gFlag;\n  }\n}\n\nexport function colAuthFilter(columns, pre) {\n  var authList = getNoAuthCols(pre);\n  var cols = columns.filter(function (item) {\n    if (hasColoum(item, authList)) {\n      return true;\n    }\n\n    return false;\n  });\n  return cols;\n}\n/**\n * 【子表行编辑】实现两个功能：\n * 1、隐藏JEditableTable无权限的字段\n * 2、禁用JEditableTable无权限的字段\n * @param columns\n * @param pre\n * @returns {*}\n */\n\nexport function colAuthFilterJEditableTable(columns, pre) {\n  var authList = getAllShowAndDisabledAuthCols(pre);\n  var cols = columns.filter(function (item) {\n    var oneAuth = authList.find(function (auth) {\n      return auth.action === pre + item.key;\n    });\n\n    if (!oneAuth) {\n      return true;\n    } //代码严谨处理，防止一个授权标识，配置多次\n\n\n    if (oneAuth instanceof Array) {\n      oneAuth = oneAuth[0];\n    } //禁用逻辑\n\n\n    if (oneAuth.type == '2' && !oneAuth.isAuth) {\n      item[\"disabled\"] = true;\n      return true;\n    } //隐藏逻辑逻辑\n\n\n    if (oneAuth.type == '1' && !oneAuth.isAuth) {\n      return false;\n    }\n\n    return true;\n  });\n  return cols;\n}\n\nfunction hasColoum(item, authList) {\n  if (authList.includes(item.dataIndex)) {\n    return false;\n  }\n\n  return true;\n} //权限无效时不做控制，有效时控制，只能控制 显示不显示\n//根据授权码前缀获取未授权的列信息\n\n\nexport function getNoAuthCols(pre) {\n  if (!pre || pre.length == 0) {\n    return [];\n  }\n\n  var permissionList = [];\n  var allPermissionList = []; //let authList = Vue.ls.get(USER_AUTH);\n\n  var authList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n\n  var _iterator7 = _createForOfIteratorHelper(authList),\n      _step7;\n\n  try {\n    for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n      var auth = _step7.value;\n\n      //显示策略，有效状态\n      if (auth.type == '1' && startWith(auth.action, pre)) {\n        permissionList.push(substrPre(auth.action, pre));\n      }\n    } //console.log(\"页面禁用权限--Global--\",sessionStorage.getItem(SYS_BUTTON_AUTH));\n\n  } catch (err) {\n    _iterator7.e(err);\n  } finally {\n    _iterator7.f();\n  }\n\n  var allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n\n  var _iterator8 = _createForOfIteratorHelper(allAuthList),\n      _step8;\n\n  try {\n    for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {\n      var gauth = _step8.value;\n\n      //显示策略，有效状态\n      if (gauth.type == '1' && gauth.status == '1' && startWith(gauth.action, pre)) {\n        allPermissionList.push(substrPre(gauth.action, pre));\n      }\n    }\n  } catch (err) {\n    _iterator8.e(err);\n  } finally {\n    _iterator8.f();\n  }\n\n  var cols = allPermissionList.filter(function (item) {\n    if (permissionList.includes(item)) {\n      return false;\n    }\n\n    return true;\n  });\n  return cols;\n}\n/**\n * 将Online的行编辑按钮权限，添加至本地存储\n */\n\nexport function addOnlineBtAuth2Storage(pre, authList) {\n  var allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  var newAuthList = allAuthList.filter(function (item) {\n    if (!item.action) {\n      return true;\n    }\n\n    return item.action.indexOf(pre) < 0;\n  });\n\n  if (authList && authList.length > 0) {\n    var _iterator9 = _createForOfIteratorHelper(authList),\n        _step9;\n\n    try {\n      for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {\n        var item = _step9.value;\n        newAuthList.push({\n          action: pre + item,\n          type: 1,\n          status: 1\n        });\n      }\n    } catch (err) {\n      _iterator9.e(err);\n    } finally {\n      _iterator9.f();\n    }\n\n    var temp = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n    var newArr = temp.filter(function (item) {\n      if (!item.action) {\n        return true;\n      }\n\n      return item.action.indexOf(pre) < 0 || authList.indexOf(item.action.replace(pre, '')) < 0;\n    });\n    sessionStorage.setItem(USER_AUTH, JSON.stringify(newArr));\n  }\n\n  sessionStorage.setItem(SYS_BUTTON_AUTH, JSON.stringify(newAuthList));\n}\n/**\n * 额外增加方法【用于行编辑组件】\n * date: 2020-04-05\n * author: scott\n * @param pre\n * @returns {*[]}\n */\n\nfunction getAllShowAndDisabledAuthCols(pre) {\n  //用户拥有的权限\n  var userAuthList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\"); //全部权限配置\n\n  var allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  var newAllAuthList = allAuthList.map(function (item, index) {\n    var hasAuthArray = userAuthList.filter(function (u) {\n      return u.action === item.action;\n    });\n\n    if (hasAuthArray && hasAuthArray.length > 0) {\n      item[\"isAuth\"] = true;\n    }\n\n    return item;\n  });\n  return newAllAuthList;\n}\n\nfunction startWith(str, pre) {\n  if (pre == null || pre == \"\" || str == null || str == \"\" || str.length == 0 || pre.length > str.length) return false;\n  if (str.substr(0, pre.length) == pre) return true;else return false;\n}\n\nfunction substrPre(str, pre) {\n  return str.substr(pre.length);\n}",{"version":3,"sources":["D:/云晟/前端/ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326/src/utils/authFilter.js"],"names":["USER_AUTH","SYS_BUTTON_AUTH","disabledAuthFilter","code","formData","nodeDisabledAuth","globalDisabledAuth","permissionList","bpmList","filter","item","type","e","length","console","log","permissions","push","action","includes","item2","allPermissionList","authList","JSON","parse","sessionStorage","getItem","auth","allAuthList","gauth","gFlag","invalidFlag","undefined","itemG","status","colAuthFilter","columns","pre","getNoAuthCols","cols","hasColoum","colAuthFilterJEditableTable","getAllShowAndDisabledAuthCols","oneAuth","find","key","Array","isAuth","dataIndex","startWith","substrPre","addOnlineBtAuth2Storage","newAuthList","indexOf","temp","newArr","replace","setItem","stringify","userAuthList","newAllAuthList","map","index","hasAuthArray","u","str","substr"],"mappings":"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","sourcesContent":["import { USER_AUTH,SYS_BUTTON_AUTH } from \"@/store/mutation-types\"\n\nexport function disabledAuthFilter(code,formData) {\n  if(nodeDisabledAuth(code,formData)){\n    return true;\n  }else{\n    return globalDisabledAuth(code);\n  }\n}\n\nfunction nodeDisabledAuth(code,formData){\n  //console.log(\"页面权限禁用--NODE--开始\");\n  let permissionList = [];\n  try {\n    //console.log(\"页面权限禁用--NODE--开始\",formData);\n    if (formData) {\n      let bpmList = formData.permissionList;\n      permissionList = bpmList.filter(item=>item.type=='2')\n      // for (let bpm of bpmList) {\n      //   if(bpm.type == '2') {\n      //     permissionList.push(bpm);\n      //   }\n      // }\n    }else{\n      return false;\n    }\n  } catch (e) {\n    //console.log(\"页面权限异常----\", e);\n  }\n  if (permissionList.length ==  0) {\n    return false;\n  }\n\n  console.log(\"流程节点页面权限禁用--NODE--开始\");\n  let permissions = [];\n  for (let item of permissionList) {\n    if(item.type == '2') {\n      permissions.push(item.action);\n    }\n  }\n  //console.log(\"页面权限----\"+code);\n  if (!permissions.includes(code)) {\n    return false;\n  }else{\n    for (let item2 of permissionList) {\n      if(code === item2.action){\n        console.log(\"流程节点页面权限禁用--NODE--生效\");\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nfunction globalDisabledAuth(code){\n  //console.log(\"全局页面禁用权限--Global--开始\");\n\n  let permissionList = [];\n  let allPermissionList = [];\n\n  //let authList = Vue.ls.get(USER_AUTH);\n  let authList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n  for (let auth of authList) {\n    if(auth.type == '2') {\n      permissionList.push(auth);\n    }\n  }\n  //console.log(\"页面禁用权限--Global--\",sessionStorage.getItem(SYS_BUTTON_AUTH));\n  let allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  for (let gauth of allAuthList) {\n    if(gauth.type == '2') {\n      allPermissionList.push(gauth);\n    }\n  }\n  //设置全局配置是否有命中\n  let  gFlag = false;//禁用命中\n  let invalidFlag = false;//无效命中\n  if(allPermissionList != null && allPermissionList != \"\" && allPermissionList != undefined && allPermissionList.length > 0){\n    for (let itemG of allPermissionList) {\n      if(code === itemG.action){\n        if(itemG.status == '0'){\n          invalidFlag = true;\n          break;\n        }else{\n          gFlag = true;\n          break;\n        }\n      }\n    }\n  }\n  if(invalidFlag){\n    return false;\n  }\n  if (permissionList === null || permissionList === \"\" || permissionList === undefined||permissionList.length<=0) {\n    return gFlag;\n  }\n  let permissions = [];\n  for (let item of permissionList) {\n    if(item.type == '2') {\n      permissions.push(item.action);\n    }\n  }\n  //console.log(\"页面禁用权限----\"+code);\n  if (!permissions.includes(code)) {\n    return gFlag;\n  }else{\n    for (let item2 of permissionList) {\n      if(code === item2.action){\n        //console.log(\"全局页面权限解除禁用--Global--生效\");\n        gFlag = false;\n      }\n    }\n    return gFlag;\n  }\n}\n\n\n\nexport function colAuthFilter(columns,pre) {\n  let authList = getNoAuthCols(pre);\n  const cols = columns.filter(item => {\n    if (hasColoum(item,authList)) {\n      return true\n    }\n    return false\n  })\n  return cols\n}\n\n/**\n * 【子表行编辑】实现两个功能：\n * 1、隐藏JEditableTable无权限的字段\n * 2、禁用JEditableTable无权限的字段\n * @param columns\n * @param pre\n * @returns {*}\n */\nexport function colAuthFilterJEditableTable(columns,pre) {\n  let authList = getAllShowAndDisabledAuthCols(pre);\n  const cols = columns.filter(item => {\n    let oneAuth = authList.find(auth => {\n      return auth.action === pre + item.key;\n    });\n    if(!oneAuth){\n      return true\n    }\n\n    //代码严谨处理，防止一个授权标识，配置多次\n    if(oneAuth instanceof Array){\n      oneAuth = oneAuth[0]\n    }\n\n    //禁用逻辑\n    if (oneAuth.type == '2' && !oneAuth.isAuth) {\n      item[\"disabled\"] = true\n      return true\n    }\n    //隐藏逻辑逻辑\n    if (oneAuth.type == '1' && !oneAuth.isAuth) {\n      return false\n    }\n    return true\n  })\n  return cols\n}\n\n\nfunction hasColoum(item,authList){\n  if (authList.includes(item.dataIndex)) {\n    return false\n  }\n  return true\n}\n\n//权限无效时不做控制，有效时控制，只能控制 显示不显示\n//根据授权码前缀获取未授权的列信息\nexport function getNoAuthCols(pre){\n  if(!pre || pre.length==0){\n    return []\n  }\n  let permissionList = [];\n  let allPermissionList = [];\n\n  //let authList = Vue.ls.get(USER_AUTH);\n  let authList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n  for (let auth of authList) {\n    //显示策略，有效状态\n    if(auth.type == '1'&&startWith(auth.action,pre)) {\n      permissionList.push(substrPre(auth.action,pre));\n    }\n  }\n  //console.log(\"页面禁用权限--Global--\",sessionStorage.getItem(SYS_BUTTON_AUTH));\n  let allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  for (let gauth of allAuthList) {\n    //显示策略，有效状态\n    if(gauth.type == '1'&&gauth.status == '1'&&startWith(gauth.action,pre)) {\n      allPermissionList.push(substrPre(gauth.action,pre));\n    }\n  }\n  const cols = allPermissionList.filter(item => {\n    if (permissionList.includes(item)) {\n      return false;\n    }\n    return true;\n  })\n  return cols;\n}\n\n/**\n * 将Online的行编辑按钮权限，添加至本地存储\n */\nexport function addOnlineBtAuth2Storage(pre, authList){\n  let allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n  let newAuthList = allAuthList.filter(item=>{\n    if(!item.action){\n      return true\n    }\n    return item.action.indexOf(pre)<0\n  })\n  if(authList && authList.length>0){\n    for(let item of authList){\n      newAuthList.push({\n        action: pre+item,\n        type:1,\n        status:1\n      })\n    }\n    let temp = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n    let newArr = temp.filter(item=>{\n      if(!item.action){\n        return true\n      }\n      return item.action.indexOf(pre)<0 || authList.indexOf(item.action.replace(pre, ''))<0\n    })\n    sessionStorage.setItem(USER_AUTH, JSON.stringify(newArr))\n  }\n  sessionStorage.setItem(SYS_BUTTON_AUTH, JSON.stringify(newAuthList))\n}\n\n\n\n/**\n * 额外增加方法【用于行编辑组件】\n * date: 2020-04-05\n * author: scott\n * @param pre\n * @returns {*[]}\n */\nfunction getAllShowAndDisabledAuthCols(pre){\n  //用户拥有的权限\n  let userAuthList = JSON.parse(sessionStorage.getItem(USER_AUTH) || \"[]\");\n  //全部权限配置\n  let allAuthList = JSON.parse(sessionStorage.getItem(SYS_BUTTON_AUTH) || \"[]\");\n\n  let newAllAuthList = allAuthList.map(function (item, index) {\n    let hasAuthArray = userAuthList.filter(u => u.action===item.action );\n    if (hasAuthArray && hasAuthArray.length>0) {\n      item[\"isAuth\"] = true\n    }\n    return item;\n  })\n\n  return newAllAuthList;\n}\n\nfunction startWith(str,pre) {\n  if (pre == null || pre == \"\" || str==null|| str==\"\"|| str.length == 0 || pre.length > str.length)\n    return false;\n  if (str.substr(0, pre.length) == pre)\n    return true;\n  else\n    return false;\n}\n\nfunction substrPre(str,pre) {\n  return str.substr(pre.length);\n}"]}]}