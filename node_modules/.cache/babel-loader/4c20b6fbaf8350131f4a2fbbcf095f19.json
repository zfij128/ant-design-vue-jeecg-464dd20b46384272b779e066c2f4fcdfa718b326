{"remainingRequest":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\utils\\request.js","dependencies":[{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\utils\\request.js","mtime":1665386876000},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js","mtime":1665642924601},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1665642923347}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Vue from 'vue';\nimport axios from 'axios';\nimport store from '@/store';\nimport { VueAxios } from './axios';\nimport router from '@/router/index';\nimport { ACCESS_TOKEN, TENANT_ID } from \"@/store/mutation-types\";\n/**\n * 【指定 axios的 baseURL】\n * 如果手工指定 baseURL: '/jeecg-boot'\n * 则映射后端域名，通过 vue.config.js\n * @type {*|string}\n */\n\nvar apiBaseUrl = window._CONFIG['domianURL'] || \"/jeecg-boot\"; //console.log(\"apiBaseUrl= \",apiBaseUrl)\n// 创建 axios 实例\n\nvar service = axios.create({\n  //baseURL: '/jeecg-boot',\n  baseURL: apiBaseUrl,\n  // api base_url\n  timeout: 9000 // 请求超时时间\n\n});\n\nvar err = function err(error) {\n  if (error.response) {\n    var data = error.response.data;\n    var token = Vue.ls.get(ACCESS_TOKEN);\n    console.log(\"------异常响应------\", token);\n    console.log(\"------异常响应------\", error.response.status);\n\n    switch (error.response.status) {\n      case 403:\n        Vue.prototype.$Jnotification.error({\n          message: '系统提示',\n          description: '拒绝访问',\n          duration: 4\n        });\n        break;\n\n      case 500:\n        console.log(\"------error.response------\", error.response); // update-begin- --- author:liusq ------ date:20200910 ---- for:处理Blob情况----\n\n        var type = error.response.request.responseType;\n\n        if (type === 'blob') {\n          blobToJson(data);\n          break;\n        } // update-end- --- author:liusq ------ date:20200910 ---- for:处理Blob情况----\n\n\n        if (token && data.message.includes(\"Token失效\")) {\n          // update-begin- --- author:scott ------ date:20190225 ---- for:Token失效采用弹框模式，不直接跳转----\n          if (/wxwork|dingtalk/i.test(navigator.userAgent)) {\n            Vue.prototype.$Jmessage.loading('登录已过期，正在重新登陆', 0);\n          } else {\n            Vue.prototype.$Jmodal.error({\n              title: '登录已过期',\n              content: '很抱歉，登录已过期，请重新登录',\n              okText: '重新登录',\n              mask: false,\n              onOk: function onOk() {\n                store.dispatch('Logout').then(function () {\n                  Vue.ls.remove(ACCESS_TOKEN);\n\n                  try {\n                    var path = window.document.location.pathname;\n                    console.log('location pathname -> ' + path);\n\n                    if (path != '/' && path.indexOf('/user/login') == -1) {\n                      window.location.reload();\n                    }\n                  } catch (e) {\n                    window.location.reload();\n                  }\n                });\n              }\n            });\n          } // update-end- --- author:scott ------ date:20190225 ---- for:Token失效采用弹框模式，不直接跳转----\n\n        }\n\n        break;\n\n      case 404:\n        Vue.prototype.$Jnotification.error({\n          message: '系统提示',\n          description: '很抱歉，资源未找到!',\n          duration: 4\n        });\n        break;\n\n      case 504:\n        Vue.prototype.$Jnotification.error({\n          message: '系统提示',\n          description: '网络超时'\n        });\n        break;\n\n      case 401:\n        Vue.prototype.$Jnotification.error({\n          message: '系统提示',\n          description: '很抱歉，登录已过期，请重新登录',\n          duration: 4\n        });\n\n        if (token) {\n          store.dispatch('Logout').then(function () {\n            setTimeout(function () {\n              window.location.reload();\n            }, 1500);\n          });\n        }\n\n        break;\n\n      default:\n        Vue.prototype.$Jnotification.error({\n          message: '系统提示',\n          description: data.message,\n          duration: 4\n        });\n        break;\n    }\n  } else if (error.message) {\n    if (error.message.includes('timeout')) {\n      Vue.prototype.$Jnotification.error({\n        message: '系统提示',\n        description: '网络超时'\n      });\n    } else {\n      Vue.prototype.$Jnotification.error({\n        message: '系统提示',\n        description: error.message\n      });\n    }\n  }\n\n  return Promise.reject(error);\n}; // request interceptor\n\n\nservice.interceptors.request.use(function (config) {\n  var token = Vue.ls.get(ACCESS_TOKEN);\n\n  if (token) {\n    config.headers['X-Access-Token'] = token; // 让每个请求携带自定义 token 请根据实际情况自行修改\n  } // update-begin--author:sunjianlei---date:20200723---for 如果当前在low-app环境，并且携带了appId，就向Header里传递appId\n\n\n  var $route = router.currentRoute;\n\n  if ($route && $route.name && $route.name.startsWith('low-app') && $route.params.appId) {\n    config.headers['X-Low-App-ID'] = $route.params.appId; // lowApp自定义筛选条件\n\n    if ($route.params.lowAppFilter) {\n      config.params = _objectSpread(_objectSpread({}, config.params), $route.params.lowAppFilter);\n      delete $route.params.lowAppFilter;\n    }\n  } // update-end--author:sunjianlei---date:20200723---for 如果当前在low-app环境，并且携带了appId，就向Header里传递appId\n  //update-begin-author:taoyan date:2020707 for:多租户\n\n\n  var tenantid = Vue.ls.get(TENANT_ID);\n\n  if (!tenantid) {\n    tenantid = 0;\n  }\n\n  config.headers['tenant-id'] = tenantid; //update-end-author:taoyan date:2020707 for:多租户\n\n  if (config.method == 'get') {\n    if (config.url.indexOf(\"sys/dict/getDictItems\") < 0) {\n      config.params = _objectSpread({\n        _t: Date.parse(new Date()) / 1000\n      }, config.params);\n    }\n  }\n\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n}); // response interceptor\n\nservice.interceptors.response.use(function (response) {\n  return response.data;\n}, err);\nvar installer = {\n  vm: {},\n  install: function install(Vue) {\n    var router = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    Vue.use(VueAxios, router, service);\n  }\n};\n/**\n * Blob解析\n * @param data\n */\n\nfunction blobToJson(data) {\n  var fileReader = new FileReader();\n  var token = Vue.ls.get(ACCESS_TOKEN);\n\n  fileReader.onload = function () {\n    try {\n      var jsonData = JSON.parse(this.result); // 说明是普通对象数据，后台转换失败\n\n      console.log(\"jsonData\", jsonData);\n\n      if (jsonData.status === 500) {\n        console.log(\"token----------》\", token);\n\n        if (token && jsonData.message.includes(\"Token失效\")) {\n          Modal.error({\n            title: '登录已过期',\n            content: '很抱歉，登录已过期，请重新登录',\n            okText: '重新登录',\n            mask: false,\n            onOk: function onOk() {\n              store.dispatch('Logout').then(function () {\n                Vue.ls.remove(ACCESS_TOKEN);\n                window.location.reload();\n              });\n            }\n          });\n        }\n      }\n    } catch (err) {\n      // 解析成对象失败，说明是正常的文件流\n      console.log(\"blob解析fileReader返回err\", err);\n    }\n  };\n\n  fileReader.readAsText(data);\n}\n\nexport { installer as VueAxios, service as axios };",{"version":3,"sources":["D:/云晟/前端/ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326/src/utils/request.js"],"names":["Vue","axios","store","VueAxios","router","ACCESS_TOKEN","TENANT_ID","apiBaseUrl","window","_CONFIG","service","create","baseURL","timeout","err","error","response","data","token","ls","get","console","log","status","prototype","$Jnotification","message","description","duration","type","request","responseType","blobToJson","includes","test","navigator","userAgent","$Jmessage","loading","$Jmodal","title","content","okText","mask","onOk","dispatch","then","remove","path","document","location","pathname","indexOf","reload","e","setTimeout","Promise","reject","interceptors","use","config","headers","$route","currentRoute","name","startsWith","params","appId","lowAppFilter","tenantid","method","url","_t","Date","parse","installer","vm","install","fileReader","FileReader","onload","jsonData","JSON","result","Modal","readAsText"],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport axios from 'axios'\nimport store from '@/store'\nimport { VueAxios } from './axios'\nimport router from '@/router/index'\nimport { ACCESS_TOKEN, TENANT_ID } from \"@/store/mutation-types\"\n\n/**\n * 【指定 axios的 baseURL】\n * 如果手工指定 baseURL: '/jeecg-boot'\n * 则映射后端域名，通过 vue.config.js\n * @type {*|string}\n */\nlet apiBaseUrl = window._CONFIG['domianURL'] || \"/jeecg-boot\";\n//console.log(\"apiBaseUrl= \",apiBaseUrl)\n// 创建 axios 实例\nconst service = axios.create({\n  //baseURL: '/jeecg-boot',\n  baseURL: apiBaseUrl, // api base_url\n  timeout: 9000 // 请求超时时间\n})\n\nconst err = (error) => {\n  if (error.response) {\n    let data = error.response.data\n    const token = Vue.ls.get(ACCESS_TOKEN)\n    console.log(\"------异常响应------\",token)\n    console.log(\"------异常响应------\",error.response.status)\n    switch (error.response.status) {\n      case 403:\n        Vue.prototype.$Jnotification.error({ message: '系统提示', description: '拒绝访问',duration: 4})\n        break\n      case 500:\n        console.log(\"------error.response------\",error.response)\n        // update-begin- --- author:liusq ------ date:20200910 ---- for:处理Blob情况----\n        let type=error.response.request.responseType;\n        if(type === 'blob'){\n          blobToJson(data);\n          break;\n        }\n        // update-end- --- author:liusq ------ date:20200910 ---- for:处理Blob情况----\n        if(token && data.message.includes(\"Token失效\")){\n          // update-begin- --- author:scott ------ date:20190225 ---- for:Token失效采用弹框模式，不直接跳转----\n          if (/wxwork|dingtalk/i.test(navigator.userAgent)) {\n            Vue.prototype.$Jmessage.loading('登录已过期，正在重新登陆', 0)\n          } else {\n            Vue.prototype.$Jmodal.error({\n              title: '登录已过期',\n              content: '很抱歉，登录已过期，请重新登录',\n              okText: '重新登录',\n              mask: false,\n              onOk: () => {\n                store.dispatch('Logout').then(() => {\n                  Vue.ls.remove(ACCESS_TOKEN)\n                  try {\n                    let path = window.document.location.pathname\n                    console.log('location pathname -> ' + path)\n                    if (path != '/' && path.indexOf('/user/login') == -1) {\n                      window.location.reload()\n                    }\n                  } catch (e) {\n                    window.location.reload()\n                  }\n                })\n              }\n            })\n          }\n          // update-end- --- author:scott ------ date:20190225 ---- for:Token失效采用弹框模式，不直接跳转----\n        }\n        break\n      case 404:\n          Vue.prototype.$Jnotification.error({ message: '系统提示', description:'很抱歉，资源未找到!',duration: 4})\n        break\n      case 504:\n        Vue.prototype.$Jnotification.error({ message: '系统提示', description: '网络超时'})\n        break\n      case 401:\n        Vue.prototype.$Jnotification.error({ message: '系统提示', description:'很抱歉，登录已过期，请重新登录',duration: 4})\n        if (token) {\n          store.dispatch('Logout').then(() => {\n            setTimeout(() => {\n              window.location.reload()\n            }, 1500)\n          })\n        }\n        break\n      default:\n        Vue.prototype.$Jnotification.error({\n          message: '系统提示',\n          description: data.message,\n          duration: 4\n        })\n        break\n    }\n  } else if (error.message) {\n    if (error.message.includes('timeout')) {\n      Vue.prototype.$Jnotification.error({message: '系统提示', description: '网络超时'})\n    } else {\n      Vue.prototype.$Jnotification.error({message: '系统提示', description: error.message})\n    }\n  }\n  return Promise.reject(error)\n};\n\n// request interceptor\nservice.interceptors.request.use(config => {\n  const token = Vue.ls.get(ACCESS_TOKEN)\n  if (token) {\n    config.headers[ 'X-Access-Token' ] = token // 让每个请求携带自定义 token 请根据实际情况自行修改\n  }\n\n  // update-begin--author:sunjianlei---date:20200723---for 如果当前在low-app环境，并且携带了appId，就向Header里传递appId\n  const $route = router.currentRoute\n  if ($route && $route.name && $route.name.startsWith('low-app') && $route.params.appId) {\n    config.headers['X-Low-App-ID'] = $route.params.appId\n    // lowApp自定义筛选条件\n    if ($route.params.lowAppFilter) {\n      config.params = {...config.params, ...$route.params.lowAppFilter}\n      delete $route.params.lowAppFilter\n    }\n  }\n  // update-end--author:sunjianlei---date:20200723---for 如果当前在low-app环境，并且携带了appId，就向Header里传递appId\n\n  //update-begin-author:taoyan date:2020707 for:多租户\n  let tenantid = Vue.ls.get(TENANT_ID)\n  if (!tenantid) {\n    tenantid = 0;\n  }\n  config.headers[ 'tenant-id' ] = tenantid\n  //update-end-author:taoyan date:2020707 for:多租户\n  if(config.method=='get'){\n    if(config.url.indexOf(\"sys/dict/getDictItems\")<0){\n      config.params = {\n        _t: Date.parse(new Date())/1000,\n        ...config.params\n      }\n    }\n  }\n  return config\n},(error) => {\n  return Promise.reject(error)\n})\n\n// response interceptor\nservice.interceptors.response.use((response) => {\n    return response.data\n  }, err)\n\nconst installer = {\n  vm: {},\n  install (Vue, router = {}) {\n    Vue.use(VueAxios, router, service)\n  }\n}\n/**\n * Blob解析\n * @param data\n */\nfunction blobToJson(data) {\n  let fileReader = new FileReader();\n  let token = Vue.ls.get(ACCESS_TOKEN);\n  fileReader.onload = function() {\n    try {\n      let jsonData = JSON.parse(this.result);  // 说明是普通对象数据，后台转换失败\n      console.log(\"jsonData\",jsonData)\n      if (jsonData.status === 500) {\n        console.log(\"token----------》\",token)\n        if(token && jsonData.message.includes(\"Token失效\")){\n          Modal.error({\n            title: '登录已过期',\n            content: '很抱歉，登录已过期，请重新登录',\n            okText: '重新登录',\n            mask: false,\n            onOk: () => {\n              store.dispatch('Logout').then(() => {\n                Vue.ls.remove(ACCESS_TOKEN)\n                window.location.reload()\n              })\n            }\n          })\n        }\n      }\n    } catch (err) {\n      // 解析成对象失败，说明是正常的文件流\n      console.log(\"blob解析fileReader返回err\",err)\n    }\n  };\n  fileReader.readAsText(data)\n}\n\nexport {\n  installer as VueAxios,\n  service as axios\n}"]}]}