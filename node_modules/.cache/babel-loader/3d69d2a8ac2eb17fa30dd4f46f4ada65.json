{"remainingRequest":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\views\\user\\LoginSelectTenant.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\views\\user\\LoginSelectTenant.vue","mtime":1665386876000},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js","mtime":1665642924601},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js","mtime":1665642924058}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Vue from 'vue';\nimport { putAction } from '@/api/manage';\nimport { USER_INFO } from '@/store/mutation-types';\nexport default {\n  name: 'LoginSelectTenant',\n  data: function data() {\n    return {\n      visible: false,\n      isMultiDepart: false,\n      departList: [],\n      isMultiTenant: false,\n      tenantList: [],\n      username: '',\n      orgCode: '',\n      tenant_id: '',\n      validate_status1: \"\",\n      validate_status2: \"\"\n    };\n  },\n  computed: {\n    title: function title() {\n      if (this.isMultiDepart && this.isMultiTenant) {\n        return '请选择租户和部门';\n      } else if (this.isMultiDepart && !this.isMultiTenant) {\n        return '请选择部门';\n      } else if (!this.isMultiDepart && this.isMultiTenant) {\n        return '请选择租户';\n      }\n    }\n  },\n  methods: {\n    clear: function clear() {\n      this.departList = [];\n      this.tenantList = [];\n      this.visible = false;\n      this.validate_status1 = '';\n      this.validate_status2 = '';\n    },\n    bizDepart: function bizDepart(loginResult) {\n      var multi_depart = loginResult.multi_depart; //0:无部门 1:一个部门 2:多个部门\n\n      if (multi_depart == 0) {\n        this.$notification.warn({\n          message: '提示',\n          description: \"\\u60A8\\u5C1A\\u672A\\u5F52\\u5C5E\\u90E8\\u95E8,\\u8BF7\\u786E\\u8BA4\\u8D26\\u53F7\\u4FE1\\u606F\",\n          duration: 3\n        });\n        this.isMultiDepart = false;\n      } else if (multi_depart == 2) {\n        this.visible = true;\n        this.isMultiDepart = true;\n        this.departList = loginResult.departs;\n      } else {\n        this.isMultiDepart = false;\n      }\n    },\n    bizTenantList: function bizTenantList(loginResult) {\n      var tenantList = loginResult.tenantList;\n\n      if (Array.isArray(tenantList)) {\n        if (tenantList.length === 0) {\n          this.isMultiTenant = false;\n        } else if (tenantList.length === 1) {\n          this.tenant_id = tenantList[0].id;\n          this.isMultiTenant = false;\n        } else {\n          this.visible = true;\n          this.isMultiTenant = true;\n          this.tenantList = tenantList;\n        }\n      }\n    },\n    show: function show(loginResult) {\n      this.clear();\n      this.bizDepart(loginResult);\n      var user = Vue.ls.get(USER_INFO);\n      this.username = user.username;\n      this.bizTenantList(loginResult);\n\n      if (this.visible === false) {\n        this.$store.dispatch('saveTenant', this.tenant_id);\n        this.$emit('success');\n      }\n    },\n    requestFailed: function requestFailed(err) {\n      this.$notification['error']({\n        message: '登录失败',\n        description: ((err.response || {}).data || {}).message || err.message || \"请求出现错误，请稍后再试\",\n        duration: 4\n      });\n      this.loginBtn = false;\n    },\n    departResolve: function departResolve() {\n      var _this = this;\n\n      return new Promise(function (resolve, reject) {\n        if (_this.isMultiDepart === false) {\n          resolve();\n        } else {\n          var obj = {\n            orgCode: _this.orgCode,\n            username: _this.username\n          };\n          putAction(\"/sys/selectDepart\", obj).then(function (res) {\n            if (res.success) {\n              var userInfo = res.result.userInfo;\n              Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\n\n              _this.$store.commit('SET_INFO', userInfo); //console.log(\"---切换组织机构---userInfo-------\",store.getters.userInfo.orgCode);\n\n\n              resolve();\n            } else {\n              _this.requestFailed(res);\n\n              _this.$store.dispatch('Logout');\n\n              reject();\n            }\n          });\n        }\n      });\n    },\n    selectOk: function selectOk() {\n      var _this2 = this;\n\n      if (this.isMultiTenant && !this.tenant_id) {\n        this.validate_status1 = 'error';\n        return false;\n      }\n\n      if (this.isMultiDepart && !this.orgCode) {\n        this.validate_status2 = 'error';\n        return false;\n      }\n\n      this.departResolve().then(function () {\n        _this2.$store.dispatch('saveTenant', _this2.tenant_id);\n\n        if (_this2.isMultiTenant) {\n          _this2.$emit('success');\n        } else {\n          _this2.$emit('success');\n        }\n      }).catch(function () {\n        console.log('登录选择出问题');\n      });\n    },\n    handleTenantChange: function handleTenantChange(e) {\n      this.validate_status1 = '';\n      this.tenant_id = e;\n    },\n    handleDepartChange: function handleDepartChange(e) {\n      this.validate_status2 = '';\n      this.orgCode = e;\n    }\n  }\n};",{"version":3,"sources":["LoginSelectTenant.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <a-modal\n    :title=\"title\"\n    :width=\"450\"\n    :visible=\"visible\"\n    :closable=\"false\"\n    :maskClosable=\"false\">\n\n    <template slot=\"footer\">\n      <a-button type=\"primary\" @click=\"selectOk\">确认</a-button>\n    </template>\n\n    <a-form-model>\n      <a-form-model-item v-if=\"isMultiTenant\" :labelCol=\"{span:4}\" :wrapperCol=\"{span:20}\" style=\"margin-bottom:10px\" :validate-status=\"validate_status1\">\n        <a-tooltip placement=\"topLeft\" >\n          <template slot=\"title\">\n            <span>您有多个租户，请选择登录租户</span>\n          </template>\n          <a-avatar style=\"backgroundColor:#87d068\" icon=\"gold\" />\n        </a-tooltip>\n\n        <a-select @change=\"handleTenantChange\" :class=\"{'valid-error':validate_status1=='error'}\" placeholder=\"请选择登录租户\" style=\"margin-left:10px;width: 80%\">\n          <a-icon slot=\"suffixIcon\" type=\"gold\" />\n          <a-select-option v-for=\"d in tenantList\" :key=\"d.id\" :value=\"d.id\">\n            {{ d.name }}\n          </a-select-option>\n        </a-select>\n      </a-form-model-item>\n\n\n      <a-form-model-item v-if=\"isMultiDepart\" :labelCol=\"{span:4}\" :wrapperCol=\"{span:20}\" style=\"margin-bottom:10px\" :validate-status=\"validate_status2\">\n        <a-tooltip placement=\"topLeft\" >\n          <template slot=\"title\">\n            <span>您有多个部门，请选择登录部门</span>\n          </template>\n          <a-avatar style=\"backgroundColor:rgb(104, 208, 203);\" icon=\"gold\" />\n        </a-tooltip>\n\n        <a-select @change=\"handleDepartChange\" :class=\"{'valid-error':validate_status2=='error'}\" placeholder=\"请选择登录部门\" style=\"margin-left:10px;width: 80%\">\n          <a-icon slot=\"suffixIcon\" type=\"gold\" />\n          <a-select-option v-for=\"d in departList\" :key=\"d.id\" :value=\"d.orgCode\">\n            {{ d.departName }}\n          </a-select-option>\n        </a-select>\n      </a-form-model-item>\n\n    </a-form-model>\n  </a-modal>\n</template>\n\n<script>\n\nimport Vue from 'vue'\nimport { putAction } from '@/api/manage'\nimport { USER_INFO } from '@/store/mutation-types'\n\nexport default {\n    name: 'LoginSelectTenant',\n    data(){\n      return {\n        visible: false,\n        isMultiDepart:false,\n        departList:[],\n\n        isMultiTenant:false,\n        tenantList:[],\n\n        username:'',\n        orgCode:'',\n        tenant_id:'',\n\n        validate_status1: \"\",\n        validate_status2: \"\",\n      }\n    },\n    computed:{\n      title(){\n        if(this.isMultiDepart && this.isMultiTenant){\n          return '请选择租户和部门'\n        }else if(this.isMultiDepart && !this.isMultiTenant){\n          return '请选择部门'\n        }else if(!this.isMultiDepart && this.isMultiTenant){\n          return '请选择租户'\n        }\n      }\n    },\n    methods:{\n      clear(){\n        this.departList = []\n        this.tenantList = []\n        this.visible=false\n        this.validate_status1=''\n        this.validate_status2=''\n      },\n      bizDepart(loginResult){\n        let multi_depart = loginResult.multi_depart\n        //0:无部门 1:一个部门 2:多个部门\n        if(multi_depart==0){\n          this.$notification.warn({\n            message: '提示',\n            description: `您尚未归属部门,请确认账号信息`,\n            duration:3\n          });\n          this.isMultiDepart = false\n        }else if(multi_depart==2){\n          this.visible=true\n          this.isMultiDepart = true\n          this.departList = loginResult.departs\n        }else {\n          this.isMultiDepart = false\n        }\n      },\n      bizTenantList(loginResult) {\n        let tenantList = loginResult.tenantList\n        if (Array.isArray(tenantList)) {\n          if (tenantList.length === 0) {\n            this.isMultiTenant = false\n          } else if (tenantList.length === 1) {\n            this.tenant_id = tenantList[0].id\n            this.isMultiTenant = false\n          } else {\n            this.visible = true\n            this.isMultiTenant = true\n            this.tenantList = tenantList\n          }\n        }\n      },\n      show(loginResult){\n        this.clear();\n        this.bizDepart(loginResult);\n\n        let user = Vue.ls.get(USER_INFO)\n        this.username = user.username\n        this.bizTenantList(loginResult);\n\n        if(this.visible===false){\n          this.$store.dispatch('saveTenant', this.tenant_id);\n          this.$emit('success')\n        }\n\n      },\n      requestFailed (err) {\n        this.$notification[ 'error' ]({\n          message: '登录失败',\n          description: ((err.response || {}).data || {}).message || err.message || \"请求出现错误，请稍后再试\",\n          duration: 4,\n        });\n        this.loginBtn = false;\n      },\n      departResolve(){\n        return new Promise((resolve, reject)=>{\n          if(this.isMultiDepart===false){\n            resolve();\n          }else{\n            let obj = {\n              orgCode:this.orgCode,\n              username:this.username\n            }\n            putAction(\"/sys/selectDepart\",obj).then(res=>{\n              if(res.success){\n                const userInfo = res.result.userInfo;\n                Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\n                this.$store.commit('SET_INFO', userInfo);\n                //console.log(\"---切换组织机构---userInfo-------\",store.getters.userInfo.orgCode);\n                resolve();\n              }else{\n                this.requestFailed(res)\n                this.$store.dispatch('Logout');\n                reject();\n              }\n            })\n          }\n        })\n      },\n      selectOk(){\n        if(this.isMultiTenant && !this.tenant_id){\n          this.validate_status1='error'\n          return false\n        }\n        if(this.isMultiDepart && !this.orgCode){\n          this.validate_status2='error'\n          return false\n        }\n        this.departResolve().then(()=>{\n          this.$store.dispatch('saveTenant', this.tenant_id);\n          if(this.isMultiTenant){\n            this.$emit('success')\n          }else{\n            this.$emit('success')\n          }\n        }).catch(()=>{\n          console.log('登录选择出问题')\n        })\n      },\n      handleTenantChange(e){\n        this.validate_status1 = ''\n        this.tenant_id = e\n      },\n      handleDepartChange(e){\n        this.validate_status2 = ''\n        this.orgCode = e\n      }\n    }\n  }\n</script>\n\n<style scoped>\n\n</style>"],"sourceRoot":"src/views/user"}]}