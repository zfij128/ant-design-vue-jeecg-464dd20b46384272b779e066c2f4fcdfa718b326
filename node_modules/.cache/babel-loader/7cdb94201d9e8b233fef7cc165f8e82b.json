{"remainingRequest":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\components\\jeecg\\JEasyCron\\EasyCron.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\src\\components\\jeecg\\JEasyCron\\EasyCron.vue","mtime":1665386876000},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\babel-loader\\lib\\index.js","mtime":1665642924601},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665642925904},{"path":"D:\\云晟\\前端\\ant-design-vue-jeecg-464dd20b46384272b779e066c2f4fcdfa718b326\\node_modules\\vue-loader\\lib\\index.js","mtime":1665642924058}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport SecondUi from './tabs/second';\nimport MinuteUi from './tabs/minute';\nimport HourUi from './tabs/hour';\nimport DayUi from './tabs/day';\nimport WeekUi from './tabs/week';\nimport MonthUi from './tabs/month';\nimport YearUi from './tabs/year';\nimport CronParser from 'cron-parser';\nimport dateFormat from './format-date';\nimport { simpleDebounce } from '@/utils/util';\nimport ACol from 'ant-design-vue/es/grid/Col';\nexport default {\n  name: 'easy-cron',\n  components: {\n    ACol: ACol,\n    SecondUi: SecondUi,\n    MinuteUi: MinuteUi,\n    HourUi: HourUi,\n    DayUi: DayUi,\n    WeekUi: WeekUi,\n    MonthUi: MonthUi,\n    YearUi: YearUi\n  },\n  props: {\n    cronValue: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    hideSecond: {\n      type: Boolean,\n      default: false\n    },\n    hideYear: {\n      type: Boolean,\n      default: false\n    },\n    remote: {\n      type: Function,\n      default: null\n    }\n  },\n  data: function data() {\n    return {\n      curtab: this.hideSecond ? 'minute' : 'second',\n      second: '*',\n      minute: '*',\n      hour: '*',\n      day: '*',\n      month: '*',\n      week: '?',\n      year: '*',\n      inputValues: {\n        second: '',\n        minute: '',\n        hour: '',\n        day: '',\n        month: '',\n        week: '',\n        year: '',\n        cron: ''\n      },\n      preTimeList: '执行预览，会忽略年份参数'\n    };\n  },\n  computed: {\n    cronValue_c: function cronValue_c() {\n      var result = [];\n      if (!this.hideSecond) result.push(this.second ? this.second : '*');\n      result.push(this.minute ? this.minute : '*');\n      result.push(this.hour ? this.hour : '*');\n      result.push(this.day ? this.day : '*');\n      result.push(this.month ? this.month : '*');\n      result.push(this.week ? this.week : '?');\n      if (!this.hideYear && !this.hideSecond) result.push(this.year ? this.year : '*');\n      return result.join(' ');\n    },\n    cronValue_c2: function cronValue_c2() {\n      var v = this.cronValue_c;\n      if (this.hideYear || this.hideSecond) return v;\n      var vs = v.split(' ');\n\n      if (vs.length >= 6) {\n        // 将 Quartz 星期 的规则转换为 CronParser 的规则\n        vs[5] = this.convertQuartzWeekToCParser(vs[5]);\n      }\n\n      return vs.slice(0, vs.length - 1).join(' ');\n    }\n  },\n  watch: {\n    cronValue: function cronValue(newVal, oldVal) {\n      if (newVal === this.cronValue_c) {\n        // console.info('same cron value: ' + newVal)\n        return;\n      }\n\n      this.formatValue();\n    },\n    cronValue_c: function cronValue_c(newVal, oldVal) {\n      this.calTriggerList();\n      this.$emit('change', newVal);\n      this.assignInput();\n    },\n    minute: function minute() {\n      if (this.second === '*') {\n        this.second = '0';\n      }\n    },\n    hour: function hour() {\n      if (this.minute === '*') {\n        this.minute = '0';\n      }\n    },\n    day: function day(_day) {\n      if (_day !== '?' && this.hour === '*') {\n        this.hour = '0';\n      }\n    },\n    week: function week(_week) {\n      if (_week !== '?' && this.hour === '*') {\n        this.hour = '0';\n      }\n    },\n    month: function month() {\n      if (this.day === '?' && this.week === '*') {\n        this.week = '1';\n      } else if (this.week === '?' && this.day === '*') {\n        this.day = '1';\n      }\n    },\n    year: function year() {\n      if (this.month === '*') {\n        this.month = '1';\n      }\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    this.formatValue();\n    this.$nextTick(function () {\n      _this.calTriggerListInner();\n    });\n  },\n  methods: {\n    assignInput: function assignInput() {\n      Object.assign(this.inputValues, {\n        second: this.second,\n        minute: this.minute,\n        hour: this.hour,\n        day: this.day,\n        month: this.month,\n        week: this.week,\n        year: this.year,\n        cron: this.cronValue_c\n      });\n    },\n    formatValue: function formatValue() {\n      if (!this.cronValue) return;\n      var values = this.cronValue.split(' ').filter(function (item) {\n        return !!item;\n      });\n      if (!values || values.length <= 0) return;\n      var i = 0;\n      if (!this.hideSecond) this.second = values[i++];\n      if (values.length > i) this.minute = values[i++];\n      if (values.length > i) this.hour = values[i++];\n      if (values.length > i) this.day = values[i++];\n      if (values.length > i) this.month = values[i++];\n      if (values.length > i) this.week = values[i++];\n      if (values.length > i) this.year = values[i];\n      this.assignInput();\n    },\n    // 将 Quartz 星期 的规则转换为 CronParser 的规则：\n    // Quartz 的规则：1 = 周日，2 = 周一，3 = 周二，4 = 周三，5 = 周四，6 = 周五，7 = 周六\n    // CronParser 的规则： 0 = 周日，1 = 周一，2 = 周二，3 = 周三，4 = 周四，5 = 周五，6 = 周六，7 = 周日\n    convertQuartzWeekToCParser: function convertQuartzWeekToCParser(week) {\n      var convert = function convert(v) {\n        if (v === '0') {\n          return '1';\n        }\n\n        if (v === '1') {\n          return '0';\n        }\n\n        return (Number.parseInt(v) - 1).toString();\n      }; // 匹配示例 1-7 or 1/7\n\n\n      var patten1 = /^([0-7])([-/])([0-7])$/; // 匹配示例 1,4,7\n\n      var patten2 = /^([0-7])(,[0-7])+$/;\n\n      if (/^[0-7]$/.test(week)) {\n        return convert(week);\n      } else if (patten1.test(week)) {\n        return week.replace(patten1, function ($0, before, separator, after) {\n          if (separator === '/') {\n            return convert(before) + separator + after;\n          } else {\n            return convert(before) + separator + convert(after);\n          }\n        });\n      } else if (patten2.test(week)) {\n        return week.split(',').map(function (v) {\n          return convert(v);\n        }).join(',');\n      }\n\n      return week;\n    },\n    calTriggerList: simpleDebounce(function () {\n      this.calTriggerListInner();\n    }, 500),\n    calTriggerListInner: function calTriggerListInner() {\n      var _this2 = this;\n\n      // 设置了回调函数\n      if (this.remote) {\n        this.remote(this.cronValue_c, +new Date(), function (v) {\n          _this2.preTimeList = v;\n        });\n        return;\n      }\n\n      var format = 'yyyy-MM-dd hh:mm:ss';\n      var options = {\n        currentDate: dateFormat(new Date(), format)\n      };\n      var iter = CronParser.parseExpression(this.cronValue_c2, options);\n      var result = [];\n\n      for (var i = 1; i <= 10; i++) {\n        result.push(dateFormat(new Date(iter.next()), format));\n      }\n\n      this.preTimeList = result.length > 0 ? result.join('\\n') : '无执行时间';\n    },\n    onInputBlur: function onInputBlur() {\n      this.second = this.inputValues.second;\n      this.minute = this.inputValues.minute;\n      this.hour = this.inputValues.hour;\n      this.day = this.inputValues.day;\n      this.month = this.inputValues.month;\n      this.week = this.inputValues.week;\n      this.year = this.inputValues.year;\n    },\n    onInputCronBlur: function onInputCronBlur(event) {\n      this.$emit('change', event.target.value);\n    }\n  },\n  model: {\n    prop: 'cronValue',\n    event: 'change'\n  }\n};",{"version":3,"sources":["EasyCron.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"j-easy-cron\">\n    <div class=\"content\">\n      <div>\n        <a-tabs size=\"small\" v-model=\"curtab\">\n          <a-tab-pane tab=\"秒\" key=\"second\" v-if=\"!hideSecond\">\n            <second-ui v-model=\"second\" :disabled=\"disabled\"></second-ui>\n          </a-tab-pane>\n          <a-tab-pane tab=\"分\" key=\"minute\">\n            <minute-ui v-model=\"minute\" :disabled=\"disabled\"></minute-ui>\n          </a-tab-pane>\n          <a-tab-pane tab=\"时\" key=\"hour\">\n            <hour-ui v-model=\"hour\" :disabled=\"disabled\"></hour-ui>\n          </a-tab-pane>\n          <a-tab-pane tab=\"日\" key=\"day\">\n            <day-ui v-model=\"day\" :week=\"week\" :disabled=\"disabled\"></day-ui>\n          </a-tab-pane>\n          <a-tab-pane tab=\"月\" key=\"month\">\n            <month-ui v-model=\"month\" :disabled=\"disabled\"></month-ui>\n          </a-tab-pane>\n          <a-tab-pane tab=\"周\" key=\"week\">\n            <week-ui v-model=\"week\" :day=\"day\" :disabled=\"disabled\"></week-ui>\n          </a-tab-pane>\n          <a-tab-pane tab=\"年\" key=\"year\" v-if=\"!hideYear && !hideSecond\">\n            <year-ui v-model=\"year\" :disabled=\"disabled\"></year-ui>\n          </a-tab-pane>\n        </a-tabs>\n      </div>\n      <a-divider/>\n      <!-- 执行时间预览 -->\n      <a-row :gutter=\"8\">\n        <a-col :span=\"18\" style=\"margin-top: 22px;\">\n          <a-row :gutter=\"8\">\n            <a-col :span=\"8\" style=\"margin-bottom: 8px;\">\n              <a-input addon-before=\"秒\" v-model=\"inputValues.second\" @blur=\"onInputBlur\"/>\n            </a-col>\n            <a-col :span=\"8\" style=\"margin-bottom: 8px;\">\n              <a-input addon-before=\"分\" v-model=\"inputValues.minute\" @blur=\"onInputBlur\"/>\n            </a-col>\n            <a-col :span=\"8\" style=\"margin-bottom: 8px;\">\n              <a-input addon-before=\"时\" v-model=\"inputValues.hour\" @blur=\"onInputBlur\"/>\n            </a-col>\n            <a-col :span=\"8\" style=\"margin-bottom: 8px;\">\n              <a-input addon-before=\"日\" v-model=\"inputValues.day\" @blur=\"onInputBlur\"/>\n            </a-col>\n            <a-col :span=\"8\" style=\"margin-bottom: 8px;\">\n              <a-input addon-before=\"月\" v-model=\"inputValues.month\" @blur=\"onInputBlur\"/>\n            </a-col>\n            <a-col :span=\"8\" style=\"margin-bottom: 8px;\">\n              <a-input addon-before=\"周\" v-model=\"inputValues.week\" @blur=\"onInputBlur\"/>\n            </a-col>\n            <a-col :span=\"8\" style=\"margin-bottom: 8px;\">\n              <a-input addon-before=\"年\" v-model=\"inputValues.year\" @blur=\"onInputBlur\"/>\n            </a-col>\n            <a-col :span=\"16\" style=\"margin-bottom: 8px;\">\n              <a-input addon-before=\"Cron\" v-model=\"inputValues.cron\" @blur=\"onInputCronBlur\"/>\n            </a-col>\n          </a-row>\n        </a-col>\n        <a-col :span=\"6\">\n\n          <div>近十次执行时间（不含年）</div>\n          <a-textarea type=\"textarea\" :value=\"preTimeList\" :rows=\"5\"/>\n        </a-col>\n      </a-row>\n    </div>\n  </div>\n</template>\n\n<script>\nimport SecondUi from './tabs/second'\nimport MinuteUi from './tabs/minute'\nimport HourUi from './tabs/hour'\nimport DayUi from './tabs/day'\nimport WeekUi from './tabs/week'\nimport MonthUi from './tabs/month'\nimport YearUi from './tabs/year'\nimport CronParser from 'cron-parser'\nimport dateFormat from './format-date'\nimport { simpleDebounce } from '@/utils/util'\nimport ACol from 'ant-design-vue/es/grid/Col'\n\nexport default {\n  name: 'easy-cron',\n  components: {\n    ACol,\n    SecondUi,\n    MinuteUi,\n    HourUi,\n    DayUi,\n    WeekUi,\n    MonthUi,\n    YearUi\n  },\n  props: {\n    cronValue: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    hideSecond: {\n      type: Boolean,\n      default: false\n    },\n    hideYear: {\n      type: Boolean,\n      default: false\n    },\n    remote: {\n      type: Function,\n      default: null\n    }\n  },\n  data() {\n    return {\n      curtab: this.hideSecond ? 'minute' : 'second',\n      second: '*',\n      minute: '*',\n      hour: '*',\n      day: '*',\n      month: '*',\n      week: '?',\n      year: '*',\n      inputValues: {second: '', minute: '', hour: '', day: '', month: '', week: '', year: '', cron: ''},\n      preTimeList: '执行预览，会忽略年份参数',\n    }\n  },\n  computed: {\n    cronValue_c() {\n      let result = []\n      if (!this.hideSecond) result.push(this.second ? this.second : '*')\n      result.push(this.minute ? this.minute : '*')\n      result.push(this.hour ? this.hour : '*')\n      result.push(this.day ? this.day : '*')\n      result.push(this.month ? this.month : '*')\n      result.push(this.week ? this.week : '?')\n      if (!this.hideYear && !this.hideSecond) result.push(this.year ? this.year : '*')\n      return result.join(' ')\n    },\n    cronValue_c2() {\n      const v = this.cronValue_c\n      if (this.hideYear || this.hideSecond) return v\n      const vs = v.split(' ')\n      if (vs.length >= 6) {\n        // 将 Quartz 星期 的规则转换为 CronParser 的规则\n        vs[5] = this.convertQuartzWeekToCParser(vs[5])\n      }\n      return vs.slice(0, vs.length - 1).join(' ')\n    },\n  },\n  watch: {\n    cronValue(newVal, oldVal) {\n      if (newVal === this.cronValue_c) {\n        // console.info('same cron value: ' + newVal)\n        return\n      }\n      this.formatValue()\n    },\n    cronValue_c(newVal, oldVal) {\n      this.calTriggerList()\n      this.$emit('change', newVal)\n      this.assignInput()\n    },\n    minute() {\n      if (this.second === '*') {\n        this.second = '0'\n      }\n    },\n    hour() {\n      if (this.minute === '*') {\n        this.minute = '0'\n      }\n    },\n    day(day) {\n      if (day !== '?' && this.hour === '*') {\n        this.hour = '0'\n      }\n    },\n    week(week) {\n      if (week !== '?' && this.hour === '*') {\n        this.hour = '0'\n      }\n    },\n    month() {\n      if (this.day === '?' && this.week === '*') {\n        this.week = '1'\n      } else if (this.week === '?' && this.day === '*') {\n        this.day = '1'\n      }\n    },\n    year() {\n      if (this.month === '*') {\n        this.month = '1'\n      }\n    },\n  },\n  created() {\n    this.formatValue()\n    this.$nextTick(() => {\n      this.calTriggerListInner()\n    })\n  },\n  methods: {\n    assignInput() {\n      Object.assign(this.inputValues, {\n        second: this.second,\n        minute: this.minute,\n        hour: this.hour,\n        day: this.day,\n        month: this.month,\n        week: this.week,\n        year: this.year,\n        cron: this.cronValue_c,\n      })\n    },\n    formatValue() {\n      if (!this.cronValue) return\n      const values = this.cronValue.split(' ').filter(item => !!item)\n      if (!values || values.length <= 0) return\n      let i = 0\n      if (!this.hideSecond) this.second = values[i++]\n      if (values.length > i) this.minute = values[i++]\n      if (values.length > i) this.hour = values[i++]\n      if (values.length > i) this.day = values[i++]\n      if (values.length > i) this.month = values[i++]\n      if (values.length > i) this.week = values[i++]\n      if (values.length > i) this.year = values[i]\n      this.assignInput()\n    },\n    // 将 Quartz 星期 的规则转换为 CronParser 的规则：\n    // Quartz 的规则：1 = 周日，2 = 周一，3 = 周二，4 = 周三，5 = 周四，6 = 周五，7 = 周六\n    // CronParser 的规则： 0 = 周日，1 = 周一，2 = 周二，3 = 周三，4 = 周四，5 = 周五，6 = 周六，7 = 周日\n    convertQuartzWeekToCParser(week) {\n      let convert = (v) => {\n        if (v === '0') {\n          return '1'\n        }\n        if (v === '1') {\n          return '0'\n        }\n        return (Number.parseInt(v) - 1).toString()\n      }\n      // 匹配示例 1-7 or 1/7\n      let patten1 = /^([0-7])([-/])([0-7])$/\n      // 匹配示例 1,4,7\n      let patten2 = /^([0-7])(,[0-7])+$/\n      if (/^[0-7]$/.test(week)) {\n        return convert(week)\n      } else if (patten1.test(week)) {\n        return week.replace(patten1, ($0, before, separator, after) => {\n          if (separator === '/') {\n            return convert(before) + separator + after\n          } else {\n            return convert(before) + separator + convert(after)\n          }\n        })\n      } else if (patten2.test(week)) {\n        return week.split(',').map(v => convert(v)).join(',')\n      }\n      return week\n    },\n    calTriggerList: simpleDebounce(function () {\n      this.calTriggerListInner()\n    }, 500),\n    calTriggerListInner() {\n      // 设置了回调函数\n      if (this.remote) {\n        this.remote(this.cronValue_c, +new Date(), v => {\n          this.preTimeList = v\n        })\n        return\n      }\n      const format = 'yyyy-MM-dd hh:mm:ss'\n      const options = {\n        currentDate: dateFormat(new Date(), format)\n      }\n      const iter = CronParser.parseExpression(this.cronValue_c2, options)\n      const result = []\n      for (let i = 1; i <= 10; i++) {\n        result.push(dateFormat(new Date(iter.next()), format))\n      }\n      this.preTimeList = result.length > 0 ? result.join('\\n') : '无执行时间'\n    },\n    onInputBlur(){\n      this.second = this.inputValues.second\n      this.minute = this.inputValues.minute\n      this.hour = this.inputValues.hour\n      this.day = this.inputValues.day\n      this.month = this.inputValues.month\n      this.week = this.inputValues.week\n      this.year = this.inputValues.year\n    },\n    onInputCronBlur(event){\n      this.$emit('change', event.target.value)\n    },\n  },\n  model: {\n    prop: 'cronValue',\n    event: 'change'\n  },\n}\n</script>\n\n<style scoped lang=\"less\">\n  .j-easy-cron {\n\n    /deep/ .content {\n      .ant-checkbox-wrapper + .ant-checkbox-wrapper {\n        margin-left: 0;\n      }\n    }\n\n  }\n</style>\n"],"sourceRoot":"src/components/jeecg/JEasyCron"}]}